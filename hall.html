<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>万达智慧院线云平台</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
  <!-- jvectormap -->
  <link rel="stylesheet" href="plugins/jvectormap/jquery-jvectormap-1.2.2.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
	<link rel="stylesheet" type="text/css" href="common/css/style.css"/>
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <style>
  	.circle{ height:150px;}
  </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <header class="main-header">

    <!-- Logo -->
    <a href="index.html" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <!--<span class="logo-mini"><b>万达智慧院线云平台</b></span>-->
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg"><b>万达智慧院线云平台</b></span>
    </a>

    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
      </a>
      <!-- Navbar Right Menu -->
      <div class="navbar-custom-menu">
        <ul class="nav navbar-nav">
          <!-- Control Sidebar Toggle Button -->
          <li>
            <a href="#"><span class="header-time"></span></a>
          </li>
          <li>
            <a href="#"><span class="header-tem">0</span>℃</a>
          </li>
          <li>
            <a href="#"><span class="header-btn">退出</span></a>
          </li>
        </ul>
      </div>

    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- Sidebar user panel -->
      <div class="user-panel">
        <!--<div class="pull-left image">
          <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
        </div>-->
        <div class="info">
          <p>万达客户</p>
          <a href="#"><i class="fa fa-circle text-green"></i> 在线</a>
        </div>
      </div>
      
      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu">
        <!--<li class="header">MAIN NAVIGATION</li>-->
        <li class="treeview">
          <a href="index.html">
            <i class="fa fa-home"></i> <span>万达影城</span>
          </a>
        </li>
        <li class="active treeview">
          <a href="#">
            <i class="fa fa-files-o"></i>
            <span>设备</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li><a href="hall.html?id=266,301"><i class="fa fa-circle-o"></i> 1号厅</a></li>
            <li><a href="hall.html?id=268,302"><i class="fa fa-circle-o"></i> 2号厅</a></li>
            <li><a href="hall.html?id=274,303"><i class="fa fa-circle-o"></i> 3号厅</a></li>
            <li><a href="hall.html?id=280,304"><i class="fa fa-circle-o"></i> 4号厅 </a></li>
            <li><a href="hall.html?id=284,305"><i class="fa fa-circle-o"></i> 5号厅 </a></li>
            <li><a href="hall.html?id=282,306"><i class="fa fa-circle-o"></i> 6号厅 </a></li>
            <li><a href="hall.html?id=276,307"><i class="fa fa-circle-o"></i> 7号厅 </a></li>
            <li><a href="hall.html?id=264,308"><i class="fa fa-circle-o"></i> 8号厅 </a></li>
            <li><a href="hall.html?id=262,309"><i class="fa fa-circle-o"></i> 9号厅 </a></li>
            <li><a href="air.html?id=266"><i class="fa fa-circle-o"></i> 1号厅空调</a></li>
            <li><a href="air.html?id=268"><i class="fa fa-circle-o"></i> 2号厅空调</a></li>
            <li><a href="air.html?id=274"><i class="fa fa-circle-o"></i> 3号厅空调</a></li>
            <li><a href="air.html?id=280"><i class="fa fa-circle-o"></i> 4号厅空调</a></li>
            <li><a href="air.html?id=284"><i class="fa fa-circle-o"></i> 5号厅空调 </a></li>
            <li><a href="air.html?id=282"><i class="fa fa-circle-o"></i> 6号厅空调 </a></li>
            <li><a href="air.html?id=276"><i class="fa fa-circle-o"></i> 7号厅空调 </a></li>
            <li><a href="air.html?id=264"><i class="fa fa-circle-o"></i> 8号厅空调 </a></li>
            <li><a href="air.html?id=262"><i class="fa fa-circle-o"></i> 9号厅空调 </a></li>
            <li><a href="air.html?id=260"><i class="fa fa-circle-o"></i> 大堂空调 </a></li>
            <li><a href="air.html?id=278"><i class="fa fa-circle-o"></i> 北走廊1号空调 </a></li>
            <li><a href="air.html?id=272"><i class="fa fa-circle-o"></i> 北走廊2号空调 </a></li>
            <li><a href="air.html?id=290"><i class="fa fa-circle-o"></i> 南走廊1号空调 </a></li>
            <li><a href="air.html?id=270"><i class="fa fa-circle-o"></i> 南走廊2号空调 </a></li>
            <li><a href="air.html?id=286"><i class="fa fa-circle-o"></i> 放映厅空调 </a></li>
            <li><a href="air.html?id=288"><i class="fa fa-circle-o"></i> 办公室空调 </a></li>
          </ul>
        </li>
        <li class="treeview">
          <a href="#">
            <i class="fa fa-table"></i>
            <span>数据</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
          	<li><a href="halldata.html"><i class="fa fa-circle-o"></i> 万达影厅</a></li>
            <li><a href="airdata.html"><i class="fa fa-circle-o"></i> 空调机组</a></li>
            <li><a href="eledata.html"><i class="fa fa-circle-o"></i> 空调电量</a></li>
          </ul>
        </li>
      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <!--<h1>
                万达影城
        <small>V 1.0</small>
      </h1>-->
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> 设备</a></li>
        <!--<li class="active">设备</li>-->
        <li class="active devname">影厅</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
			<!--近一个月内总电量汇总-->
      <div class="row">
        <div class="col-md-12">
          <div class="box">
            <div class="box-header with-border">
              <h3 class="box-title devname">影厅</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <div class="row hall">
                <div class="col-md-8 movie-bg">
                  <a href="halldata.html" id="halldata"><img src="common/images/1.png"/></a> 
                </div>
                <!-- /.col -->
                <div class="col-md-4 movie">
                	<p></p>
                  <p>
                                        影片名称：<span class="m-name"></span>
                  </p>
									<p>
                                        影厅名称：<span class="h-name"></span>
                  </p>
                  <p>
                                        影厅售票：<span class="h-count"></span>
                  </p>
                  <p>
                                        开始时间：<span class="m-stime"></span>
                  </p>
                  <p>
                                        结束时间：<span class="m-etime"></span>
                  </p>
                  <p>
                                        同步时间：<span class="m-stime"></span>
                  </p>
                </div>
                <!-- /.col -->
              </div>
              <!-- /.row -->
            </div>
            <!-- ./box-body -->
            <div class="box-footer">
              <div class="row">
                <div class="col-sm-2 col-xs-6 text-center">
                  <div class="circle" id="tem"></div>
                  <div class="knob-label">温度和设定点（℃）</div>
                </div>
                <!-- /.col -->
                <div class="col-sm-2 col-xs-6 text-center">
                	<div class="circle" id="humidity"></div>
                  <div class="knob-label">湿度（%）</div>
                </div>
                <!-- /.col -->
                <div class="col-sm-2 col-xs-6 text-center">
                	<div class="circle" id="PM25"></div>
                  <div class="knob-label">PM2.5（ug/m³）</div>
                </div>
                <!-- /.col -->
                <div class="col-sm-2 col-xs-6 text-center">
                	<div class="circle" id="PM10"></div>
                  <div class="knob-label">PM10（ug/m³）</div>
                </div>
                <div class="col-sm-2 col-xs-6 text-center">
                	<div class="circle" id="CO2"></div>
                  <div class="knob-label">CO2（PPM）</div>
                </div>
                <div class="col-sm-2 col-xs-6 text-center">
                	<div class="circle" id="JQ"></div>
                  <div class="knob-label">甲醛（PPM）</div>
                </div>
                <!-- /.col -->
              </div>
              <!-- /.row -->
            </div>
            <!-- /.box-footer -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
      <div class="row">
        <div class="col-md-6">
          <!-- AREA CHART -->
          <div class="box box-danger">
            <div class="box-header with-border">
              <h3 class="box-title">室内温度及室内温度设定点</h3>
            </div>
            <div class="box-body">
              <div class="chart">
                <div id="areaChart" style="height:250px"></div>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col (LEFT) -->
        <div class="col-md-6">
          <!-- LINE CHART -->
          <div class="box box-info">
            <div class="box-header with-border">
              <h3 class="box-title">室内CO2及室内甲醛</h3>
            </div>
            <div class="box-body">
              <div class="chart">
                <div id="lineChart" style="height:250px"></div>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col (RIGHT) -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <footer class="main-footer">
    <strong>蔚蓝数据 Azure City (Beijing) Technologies Inc.</strong>
  </footer>
</div>
<!-- ./wrapper -->

<!-- jQuery 2.2.3 -->
<script src="plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- FastClick -->
<script src="plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/app.min.js"></script>
<!-- Sparkline -->
<!--<script src="plugins/sparkline/jquery.sparkline.min.js"></script>

<script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>-->
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts-all-3.js"></script>
<script src="common/js/shine.js"></script>
<script src="common/js/jquery.cookie.js" type="text/javascript"></script>
<!--<script src="dist/js/demo.js"></script>-->
<script src="common/js/common.js"></script>
<script src="common/js/radialIndicator.min.js"></script>


<script>
$(function () {
    
});
var id = GetQueryString('id');
var devid = id.split(',')[0];
var src = "halldata.html?id="+devid;
$("#halldata").attr("href",src);
if(devid == '266'){
	$('.movie-bg img').attr('src','common/images/1.png');
}else if(devid == '268'){
	$('.movie-bg img').attr('src','common/images/2.png');
}else if(devid == '274'){
	$('.movie-bg img').attr('src','common/images/3.png');
}else if(devid == '280'){
	$('.movie-bg img').attr('src','common/images/4.png');
}else if(devid == '284'){
	$('.movie-bg img').attr('src','common/images/5.png');
}else if(devid == '282'){
	$('.movie-bg img').attr('src','common/images/6.png');
}else if(devid == '276'){
	$('.movie-bg img').attr('src','common/images/7.png');
}else if(devid == '264'){
	$('.movie-bg img').attr('src','common/images/8.png');
}else if(devid == '262'){
	$('.movie-bg img').attr('src','common/images/9.png');
}
//console.log(id);
//加载设备信息
selectdeveic();
//setInterval(selectdeveic,5000);
//获取最新设备信息（设备表联动设备记录表）
function selectdeveic() {
	//加载用户列表数据
	$.ajax({
	    //要用post方式     
	    type: "post",
	    //方法所在页面和方法名     
	    url: 'http://123.56.156.91:8089/getBzRecordList?params={%22deviceIds%22:%22'+ id +'%22}',
	    dataType: "jsonp",
		  jsonp: "jsonpCallback",
	    success: function (data) {
			//查看返回的数据data
			//console.log(data);
			//设备的数据信息
			var devicename = data.data[0].deviceInfo.deviceName;
			devicename = devicename.substring(0,devicename.length-2);
			//console.log(devicename);
			$('.devname').html(devicename);
			var attributes = data.data[0].attributes.split(",");
			var datas = data.data[0].bzRecord.data.split(",");
			var deviceTime = data.data[0].bzRecord.syncTime;
			
			doublepie("tem",parseFloat(datas[6]).toFixed(1),parseFloat(datas[8]).toFixed(1),100,"#1390d0","#1ab2d9");
			singlepie("humidity",datas[7],100,"#91e3e9");
			singlepie("PM25",datas[9],500,"#99cc33");
			singlepie("PM10",datas[10],500,"#75af00");
			singlepie("CO2",datas[11],2000,"#96716e");
			singlepie("JQ",datas[12],0.7,"#dc69ab");

			//影厅的信息
	    if(data.data[1].bzRecord != null) {
	        var halldata = data.data[1].bzRecord.data.split(",");
	        var stime = data.data[1].bzRecord.syncTime;
	        if(halldata[4] == 0){
	        	$('.movie').html(halldata[3] + '暂无电影放映！');
	        }else{
	            $('.m-name').html(halldata[6]);
	            $('.h-name').html(halldata[3]);
	            $('.h-count').html(halldata[2] + '/' + halldata[1]);
	            $('.m-stime').html(halldata[4]);
	            $('.m-etime').html(halldata[5]);
	            $('.m-stime').html(stime);
	        }
	    }else {
	        $('.movie').html('数据恢复中，请耐心等待！');
	    }
			
	        
	
	    var nowTimeMs = new Date().getTime() + 28800000;
			var dd = deviceTime.split(" ");
			var ddp = dd[0].split("-");
			var ddn = dd[1].split(":");
			var lastTimeMs = Date.UTC(ddp[0],(ddp[1] - 1),ddp[2],ddn[0],ddn[1],ddn[2]);
			var changeTime = nowTimeMs - lastTimeMs;
			if(changeTime > 600000){
				$("#devstatusdiv").html("设备停止超过10分钟");	
			}
	    },
	    error: function (err) {
	    	alert(err);
	    }
	});
}

// 将中国标准时间格式化为（2017-06-06 15:05:04）
function formatDateTime(theDate) {

	var _hour = theDate.getHours();
	
	var _minute = theDate.getMinutes();
	
	var _second = theDate.getSeconds();
	
	var _year = theDate.getFullYear()
	
	var _month = theDate.getMonth();
	
	var _date = theDate.getDate();
	
	if(_hour<10){_hour="0"+_hour ;}
	
	if(_minute<10){_minute="0"+_minute;  }
	
	if(_second<10){_second="0"+_second ; }
	
	_month = _month + 1;
	if(_month < 10){_month = "0" + _month;}
	
	if(_date<10){_date="0"+_date ; }
	
	return  _year + "-" + _month + "-" + _date + " " + _hour + ":" + _minute + ":" + _second ;

}

var theDate = new Date();
var _hour = theDate.getHours();
var _minute = theDate.getMinutes();
var _second = theDate.getSeconds();
var _year = theDate.getFullYear();
var _month = theDate.getMonth();
var _date = theDate.getDate();
if(_hour<10){_hour="0"+_hour  }
if(_minute<10){_minute="0"+_minute  }
if(_second<10){_second="0"+_second  }
_month = _month + 1;
	if(_month < 10){_month = "0" + _month;}
if(_date<10){_date="0"+_date  }
var _endTime =  _year + "-" + _month + "-" + _date + "%20" + _hour + ":" + _minute + ":" + _second ;
var second = new Date().getTime();

var _startTime = formatDateTime(new Date(second-(24*60*60*1000)));
//曲线加载
devicehistoryslist(devid, _startTime, _endTime)
//window.addEventListener("resize",function(){
//  devicehistoryslist(devid, _startTime, _endTime)
// });
function devicehistoryslist(devid, startdate, enddate) {
    var _url = 'http://123.56.156.91:8081/AppInterface/queryAllBzRecord?params={%22deviceId%22:'+ devid +',%22beginTime%22:%22' + startdate + '%22,%22endTime%22:%22' + enddate + '%22}';
    //加载历史数据列表
    $.ajax({
        //要用post方式
        type: "post",
        //方法所在页面和方法名
        url: _url,
        //contentType: "application/json; charset=utf-8",
        dataType: "jsonp",
        jsonp: "jsonpCallback",
        success: function (data) {
        	//console.log(data);
            if(data.data) {
                var datas = data.data.reverse();

                var xlist = new Array();

                var ary0 = new Array();

                var ary1 = new Array();

                var ary2 = new Array();

                var ary3 = new Array();

                for (var i = 0 ; i < datas.length; i++) {
                    var datasAry = datas[i].data.split(",");
                    xlist[i] = datas[i].syncTime;
                    ary0[i] = parseFloat(datasAry[6]).toFixed(1);
                    ary1[i] = parseFloat(datasAry[8]).toFixed(1);
                    ary2[i] = datasAry[11];
                    ary3[i] = datasAry[12];
                };
//              console.log(ary0);
                tem("areaChart",xlist,ary0,ary1);
                ppm("lineChart",xlist,ary2,ary3);
                
            }else{
                alert('此时间段没有数据');
            }
        },
        error: function (err) {
            alert('系统连接错误，请重试！');
        }
    });
}

function tem(id,xlist,data,data1){
	var myChart = echarts.init(document.getElementById(id),"shine");
	option = {
		grid: {
        top: 30,
        bottom: 80,
        right: 25,
        left: 35
    },
    tooltip: {
        trigger: 'axis'
    },
    legend: {
        left: 'right',
        data: ['室内温度','室内温度设定点'],
        inactiveColor: '#999',
        //selectedMode: 'single',
//      orient: 'vertical',
//      width: 150,
//      top: 50,
//      borderWidth: 2,
//      borderColor: 'blue',
        textStyle: {
            color: '#000'
        }
    },
    dataZoom: [
				{
					show: true,
					realtime: true,
					start: 0,
					end: 100,
					handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z'
				}
		],
    xAxis:  {
        type: 'category',
        boundaryGap: false,
        data : xlist.map(function (str) {
						return str.replace(' ', '\n')
					}),
    },
    yAxis: {
        type: 'value',
        name: '温度（℃）',
        axisLabel: {
            formatter: '{value}'
        }
    },
    series: [
        {
            name:'室内温度',
            type:'line',
            data: data,
            itemStyle: {
                normal: {
                    color: 'rgb(255, 70, 131)'
                }
            },
            areaStyle: {
                normal: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                        offset: 0,
                        //rgb(255, 158, 68)
                        color: '#fff184'
                    }, {
                        offset: 1,
                        //rgb(255, 70, 131)
                        color: '#fdcaab'
                    }])
                }
            }
        },
        {
            name:'室内温度设定点',
            type:'line',
            data: data1,
            itemStyle: {
                normal: {
                    color: '#2388da'
                }
            }
//          ,
//          areaStyle: {
//              normal: {
//                  color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
//                      offset: 0,
//                      color: 'rgb(255, 158, 68)'
//                  }, {
//                      offset: 1,
//                      color: 'rgb(255, 70, 131)'
//                  }])
//              }
//          }
        }
    ]
	};
	myChart.setOption(option);
}

function ppm(id,xlist,data,data1){
	var myChart = echarts.init(document.getElementById(id),"shine");
	option = {
		grid: {
        top: 30,
        bottom: 80,
        right: 40,
        left: 50
    },
    tooltip: {
        trigger: 'axis'
    },
    legend: {
        left: 'center',
        data: ['室内CO2','室内甲醛'],
        inactiveColor: '#999',
        //selectedMode: 'single',
//      orient: 'vertical',
//      width: 150,
//      top: 50,
//      borderWidth: 2,
//      borderColor: 'blue',
        textStyle: {
            color: '#000'
        }
    },
    dataZoom: [
				{
					show: true,
					realtime: true,
					start: 0,
					end: 100,
					handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z'
				}
		],
    xAxis:  {
        type: 'category',
        boundaryGap: false,
        data : xlist.map(function (str) {
						return str.replace(' ', '\n')
					}),
    },
    yAxis: [{
        type: 'value',
        name: 'CO2（PPM）',
        axisLabel: {
            formatter: '{value}'
        }
    },{
        type: 'value',
        name: '甲醛（PPM）',
        axisLabel: {
            formatter: '{value}'
        }
    }],
    series: [
        {
            name:'室内CO2',
            type:'line',
            data: data,
            itemStyle: {
                normal: {
                    color: 'rgb(255, 70, 131)'
                }
            }
        },
        {
            name:'室内甲醛',
            type:'line',
            data: data1,
            yAxisIndex: 1,
            itemStyle: {
                normal: {
                    color: '#2388da'
                }
            }
        }
    ]
	};
	myChart.setOption(option);
//	window.addEventListener("resize",function(){
//  myChart.setOption(option);
// });
}

</script>
</body>
</html>
